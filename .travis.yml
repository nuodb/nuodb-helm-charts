language: go

dist: xenial
os: linux

sudo: required

go:
  - 1.12.x

env:
  jobs:
    - TEST_SUITE=basic
    - TEST_SUITE=minikube-short REQUIRES_MINIKUBE=true
    - TEST_SUITE=minikube-long REQUIRES_MINIKUBE=true
  global:
    - HELM_VERSION="v2.9.0"
    - DEP_VERSION=0.5.4
    - KUBERNETES_VERSION=1.15.0
    - MINIKUBE_VERSION=1.2.0
    - CHANGE_MINIKUBE_NONE_USER=true
    - MINIKUBE_WANTUPDATENOTIFICATION=false
    - MINIKUBE_WANTREPORTERRORPROMPT=false
    - MINIKUBE_HOME=$HOME
    - CHANGE_MINIKUBE_NONE_USER=true
    - KUBECONFIG=$HOME/.kube/config
    - NUODB_PRINT_TO_STDOUT=true
    - NUODB_VERSION=4.0.3

cache:
  directories:
    - $GOPATH/pkg/dep

before_install:
  - sudo apt-get update
  - sudo apt-get install socat
  - chmod +x scripts/ci/install_deps.sh
  - scripts/ci/install_deps.sh

install:
  - go get -u github.com/golang/dep/cmd/dep
  - dep ensure -v

script:
  - chmod +x scripts/ci/determine_and_run_tests.sh
  - scripts/ci/determine_and_run_tests.sh
