language: go

dist: xenial
os: linux

sudo: required

go:
  - 1.12.x

env:
  global:
    - HELM_VERSION="v2.14.3"
    - DEP_VERSION=0.5.4
    - KUBERNETES_VERSION=1.15.0
    - MINIKUBE_VERSION=1.2.0
    - CHANGE_MINIKUBE_NONE_USER=true
    - MINIKUBE_WANTUPDATENOTIFICATION=false
    - MINIKUBE_WANTREPORTERRORPROMPT=false
    - MINIKUBE_HOME=$HOME
    - CHANGE_MINIKUBE_NONE_USER=true
    - KUBECONFIG=$HOME/.kube/config
    - NUODB_PRINT_TO_STDOUT=true
  - TEST_SUITE="basic"
  - TEST_SUITE="minikube-short"
  - TEST_SUITE="minikube-long"

cache:
  directories:
    - $GOPATH/pkg/dep

before_install:
  - sudo apt-get update
  - sudo apt-get install socat
  - chmod +x scripts/ci/install_deps.sh
  - scripts/ci/install_deps.sh
  - docker pull nuodb/nuodb-ce:latest
  - helm version

install:
  - go get -u github.com/golang/dep/cmd/dep
  - dep ensure -v

script:
  - 'if [ "TEST_SUITE" != "basic"  ]; then test/test_suite.sh; fi'
  - 'if [ "TEST_SUITE" != "basic"  ]; then go test -timeout 10m -v ./test/integration; fi'
  - 'if [ "TEST_SUITE" != "minikube-short"  ]; then go test -timeout 60m -v ./test/minikube -tags=short; fi'
  - 'if [ "TEST_SUITE" != "minikube-long"  ]; then go test -timeout 60m -v ./test/minikube -tags=long; fi'
