#!/bin/echo Source the script: .

read_credentials() {
    # Check that credentials file exists
    SOURCE_CREDENTIALS_FILE="/var/opt/nuodb/archive/$NUODB_DOMAIN/$DB_NAME/credentials"
    [ -f "$SOURCE_CREDENTIALS_FILE" ] || return 1

    # Read credentials file, which is assumed to be base64-encoded
    set -- $(cat "$SOURCE_CREDENTIALS_FILE" | base64 -d)
    [ $# -eq 2 ] || return 1

    # Read source user name
    SOURCE_USER="${1#user=}"
    [ "$SOURCE_USER" != "$1" ] || return 1

    # Read source password
    SOURCE_PASSWORD="${2#password=}"
    [ "$SOURCE_PASSWORD" != "$2" ] || return 1
}

read_credentials || unset SOURCE_CREDENTIALS_FILE SOURCE_USER SOURCE_PASSWORD
